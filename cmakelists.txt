cmake_minimum_required(VERSION 3.15)
project(mTerm LANGUAGES C OBJC)

# Set C standard
set(CMAKE_C_STANDARD 11)
set(CMAKE_C_STANDARD_REQUIRED ON)

# Set Objective-C standard
set(CMAKE_OBJC_FLAGS "${CMAKE_OBJC_FLAGS} -fPIC")

# Find required packages
find_package(PkgConfig QUIET)

# Set output directory
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin)

# Source files
set(SOURCES
    src/main.m
    src/inc/window.m
    src/inc/render.m
    src/inc/shell.m
    src/inc/input.m
    src/inc/terminal.m
    src/inc/clipboard.m
    src/inc/scrollback.m
    src/inc/themes.m
    src/inc/tabs.m
    src/inc/search.m
    src/inc/sessions.m
    src/inc/panes.m
    src/inc/text_renderer.m
    src/inc/url_detector.m
    src/inc/image_renderer.m
    src/inc/profiler.m
    src/inc/shell_integration.m
    src/inc/scripting.m
)

# Create executable
add_executable(mTerm ${SOURCES})

# Include directories
target_include_directories(mTerm PRIVATE
    ${CMAKE_SOURCE_DIR}/src/inc
    ${CMAKE_SOURCE_DIR}/src
)

# Link Cocoa framework and system libraries
target_link_libraries(mTerm PRIVATE
    "-framework Cocoa"
    "-framework Metal"
    "-framework MetalKit"
    "-framework QuartzCore"
    "-framework CoreGraphics"
    "-framework CoreText"
    "-framework Foundation"
    "-framework AppKit"
    "-framework CoreFoundation"
)

# Set C flags for macOS
set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wall -Wextra -O2")

# Ensure we're building for macOS
if(NOT APPLE)
    message(FATAL_ERROR "mTerm requires macOS to build")
endif()

# Set minimum macOS version
set(CMAKE_OSX_DEPLOYMENT_TARGET 10.13)

# Enable verbose output during build
set(CMAKE_VERBOSE_MAKEFILE ON)

# Installation
install(TARGETS mTerm DESTINATION bin)
